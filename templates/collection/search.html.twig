{% extends 'base.html.twig' %}

{% block title %}Recherche dans les collections - {{ parent() }}{% endblock %}

{% block body %}
    <div class="page-header">
        <div class="page-header-content">
            <h1 class="page-title">
                <span class="icon">üîç</span>
                Recherche dans les collections
            </h1>
            <a href="{{ path('app_collection_index') }}" class="btn btn--secondary">
                ‚Üê Retour
            </a>
        </div>
    </div>

    <div class="container">
        <!-- Formulaire de recherche -->
        <div class="card mb-xl">
            <div class="card__body">
                <h2 class="card__title mb-md">
                    ‚öôÔ∏è Crit√®res de recherche
                </h2>
                <form action="{{ path('app_collection_search') }}" method="get">
                    <div class="form__group">
                        <label for="search-query" class="form__label">Rechercher un objet</label>
                        <input type="text"
                               class="form__input"
                               id="search-query"
                               name="q"
                               value="{{ query }}"
                               placeholder="Ex: Super Mario, PlayStation, Manette..."
                               required>
                    </div>
                    <div class="form__group">
                        <label for="search-type" class="form__label">Type d'objet</label>
                        <select class="form__select" id="search-type" name="type">
                            <option value="all" {% if type == 'all' %}selected{% endif %}>Tous les types</option>
                            <option value="game" {% if type == 'game' %}selected{% endif %}>Jeux uniquement</option>
                            <option value="console" {% if type == 'console' %}selected{% endif %}>Consoles uniquement</option>
                            <option value="accessory" {% if type == 'accessory' %}selected{% endif %}>Accessoires uniquement</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn--accent">
                        üîç Lancer la recherche
                    </button>
                </form>
            </div>
        </div>

        {% if query %}
            <!-- R√©sultats pour les jeux -->
            {% if type == 'all' or type == 'game' %}
                {% if results.games is not empty %}
                    <div class="mb-xl">
                        <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                            <div class="section-divider divider-primary"></div>
                            <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                üéÆ Jeux trouv√©s
                                <span class="badge badge--primary">{{ results.games|length }}</span>
                            </h2>
                        </div>
                        <div class="grid grid--3">
                            {% for result in results.games %}
                                <div class="card">
                                    {% if result.item.image %}
                                        <img src="{{ result.item.image }}" class="card__image" alt="{{ result.item.title }}">
                                    {% else %}
                                        <div class="card__image" style="display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(103, 97, 168, 0.3), rgba(160, 193, 185, 0.3));">
                                            <span style="font-size: 3rem; opacity: 0.5;">üéÆ</span>
                                        </div>
                                    {% endif %}
                                    <div class="card__body">
                                        <h3 class="card__title">{{ result.item.title }}</h3>
                                        <p class="card__text text--muted mb-md">
                                            <small>{{ result.item.platform.name ?? 'N/A' }}</small>
                                        </p>

                                        <div class="owners-box">
                                            <strong class="owners-title">üë• Poss√©d√© par</strong>
                                            {% if result.owners is not empty %}
                                                <div style="margin-top: 0.5rem;">
                                                    {% for owner in result.owners %}
                                                        <a href="{{ path('app_collection_user', {'id': owner.id}) }}" class="link" style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid rgba(103, 97, 168, 0.2);">
                                                            <span>üë§ {{ owner.username }}</span>
                                                            <span class="badge badge--primary">√ó{{ owner.quantity }}</span>
                                                        </a>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text--muted" style="margin: 0.5rem 0 0;">Personne ne poss√®de ce jeu</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="card__footer">
                                        <a href="{{ path('app_game_show', {'id': result.item.id}) }}" class="btn btn--primary btn--small">
                                            Voir les d√©tails
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                {% endif %}

            <!-- R√©sultats pour les consoles -->
            {% if type == 'all' or type == 'console' %}
                {% if results.consoles is not empty %}
                    <div class="mb-xl">
                        <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                            <div class="section-divider divider-success"></div>
                            <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                üì∫ Consoles trouv√©es
                                <span class="badge badge--secondary">{{ results.consoles|length }}</span>
                            </h2>
                        </div>
                        <div class="grid grid--3">
                            {% for result in results.consoles %}
                                <div class="card">
                                    {% if result.item.image %}
                                        <img src="{{ result.item.image }}" class="card__image" alt="{{ result.item.name }}">
                                    {% else %}
                                        <div class="card__image" style="display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(160, 193, 185, 0.3), rgba(103, 97, 168, 0.3));">
                                            <span style="font-size: 3rem; opacity: 0.5;">üì∫</span>
                                        </div>
                                    {% endif %}
                                    <div class="card__body">
                                        <h3 class="card__title">{{ result.item.name }}</h3>
                                        <p class="card__text text--muted mb-md">
                                            <small>{{ result.item.manufacturer ?? 'N/A' }}</small>
                                        </p>

                                        <div class="owners-box">
                                            <strong class="owners-title">üë• Poss√©d√© par</strong>
                                            {% if result.owners is not empty %}
                                                <div style="margin-top: 0.5rem;">
                                                    {% for owner in result.owners %}
                                                        <a href="{{ path('app_collection_user', {'id': owner.id}) }}" class="link" style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid rgba(160, 193, 185, 0.2);">
                                                            <span>üë§ {{ owner.username }}</span>
                                                            <span class="badge badge--secondary">√ó{{ owner.quantity }}</span>
                                                        </a>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text--muted" style="margin: 0.5rem 0 0;">Personne ne poss√®de cette console</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="card__footer">
                                        <a href="{{ path('app_console_show', {'id': result.item.id}) }}" class="btn btn--secondary btn--small">
                                            Voir les d√©tails
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endif %}

            <!-- R√©sultats pour les accessoires -->
            {% if type == 'all' or type == 'accessory' %}
                {% if results.accessories is not empty %}
                    <div class="mb-xl">
                        <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                            <div class="section-divider divider-warning"></div>
                            <h2 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                üéß Accessoires trouv√©s
                                <span class="badge badge--accent">{{ results.accessories|length }}</span>
                            </h2>
                        </div>
                        <div class="grid grid--3">
                            {% for result in results.accessories %}
                                <div class="card">
                                    {% if result.item.image %}
                                        <img src="{{ result.item.image }}" class="card__image" alt="{{ result.item.name }}">
                                    {% else %}
                                        <div class="card__image" style="display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(163, 0, 21, 0.3), rgba(103, 97, 168, 0.3));">
                                            <span style="font-size: 3rem; opacity: 0.5;">üéß</span>
                                        </div>
                                    {% endif %}
                                    <div class="card__body">
                                        <h3 class="card__title">{{ result.item.name }}</h3>
                                        <p class="card__text text--muted mb-md">
                                            <small>{{ result.item.type ?? 'N/A' }}</small>
                                        </p>

                                        <div class="owners-box">
                                            <strong class="owners-title">üë• Poss√©d√© par</strong>
                                            {% if result.owners is not empty %}
                                                <div style="margin-top: 0.5rem;">
                                                    {% for owner in result.owners %}
                                                        <a href="{{ path('app_collection_user', {'id': owner.id}) }}" class="link" style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid rgba(163, 0, 21, 0.2);">
                                                            <span>üë§ {{ owner.username }}</span>
                                                            <span class="badge badge--accent">√ó{{ owner.quantity }}</span>
                                                        </a>
                                                    {% endfor %}
                                                </div>
                                            {% else %}
                                                <p class="text--muted" style="margin: 0.5rem 0 0;">Personne ne poss√®de cet accessoire</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="card__footer">
                                        <a href="{{ path('app_accessory_show', {'id': result.item.id}) }}" class="btn btn--accent btn--small">
                                            Voir les d√©tails
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endif %}

            <!-- Aucun r√©sultat -->
            {% if results.games is empty and results.consoles is empty and results.accessories is empty %}
                <div class="text--center" style="padding: 3rem;">
                    <p style="font-size: 3rem; margin-bottom: 1rem;">üîç</p>
                    <p class="text--muted mb-sm">Aucun r√©sultat trouv√© pour "<strong>{{ query }}</strong>"</p>
                    <p class="text--muted" style="font-size: 0.875rem;">Essayez avec un autre terme de recherche</p>
                </div>
            {% endif %}
        {% else %}
            <div class="text--center" style="padding: 3rem;">
                <p style="font-size: 3rem; margin-bottom: 1rem;">üîç</p>
                <p class="text--muted mb-sm">Utilisez le formulaire ci-dessus pour rechercher dans les collections</p>
                <p class="text--muted" style="font-size: 0.875rem;">Recherchez un jeu, une console ou un accessoire et d√©couvrez qui le poss√®de</p>
            </div>
        {% endif %}
    </div>
{% endblock %}

